{{define "casetype"}}
    <!doctype html>
    <html lang="en">
    {{template "head"}}
    <body class="bg-light">
    {{template "navbar"}}
    <div class="container">
        <div class="card">
            <div class="card-body">
                <h4 class="card-title">Case Type</h4>
                <form action="/settings/casetypes{{if .CaseType.ID}}/{{.CaseType.ID}}{{end}}" method="post">
                    <div class="form-floating mb-3">
                        {{$name := "name"}}
                        {{if and .Errors (.Errors.Find $name)}}
                            {{$errs := .Errors.Find $name}}
                            <input id="{{$name}}"
                                   type="text"
                                   name="{{$name}}"
                                   value="{{(index $errs 0).BadValue}}"
                                   data-testid="{{$name}}"
                                   class="form-control {{if $errs}}is-invalid{{end}}"
                                   aria-describedby="{{$name}}Feedback"
                            >
                            <div id="{{$name}}Feedback" class="invalid-feedback">
                                {{range $errs}}
                                    <p>{{.Detail}}</p>
                                {{end}}
                            </div>
                        {{else}}
                            <input id="{{$name}}"
                                   type="text"
                                   class="form-control"
                                   name="{{$name}}"
                                   data-testid="{{$name}}"
                                   value="{{if .CaseType}}{{.CaseType.Name}}{{end}}"
                            >
                        {{end}}
                        <label for="{{$name}}">Name</label>
                    </div>

                    <!-- TODO: Add a checkbox field for intakeCaseType -->

                    <div class="form-floating mb-3">
                        {{$name = "partyTypeId"}}
                        {{if and .Errors (.Errors.Find $name)}}
                            {{$errs := .Errors.Find $name}}
                            <select id="party-type"
                                    class="form-select {{if $errs}}is-invalid{{end}}"
                                    name="{{$name}}"
                                    aria-describedby="partyTypeIdFeedback"
                            >

                                {{if .CaseType.PartyTypeID}}
                                    {{$partyType := .PartyTypes.FindByID .CaseType.PartyTypeID}}
                                    <option selected
                                            value="{{$partyType.ID}}"
                                            data-cy="partytype-option"
                                    >
                                        {{$partyType.Name}}
                                    </option>
                                {{else}}
                                    <option selected></option>
                                {{end}}
                                {{range .PartyTypes.Items}}
                                    <option value="{{.ID}}" data-cy="partytype-option">{{.Name}}</option>
                                {{end}}
                            </select>
                            <div id="{{$name}}Feedback" class="invalid-feedback">
                                {{range $errs}}
                                    <p>{{.Detail}}</p>
                                {{end}}
                            </div>
                        {{else}}
                            <select id="party-type"
                                    class="form-select"
                                    name="{{$name}}"
                                    {{if .CaseType}}disabled{{end}}
                            >
                                {{if .CaseType}}
                                    {{$partyType := .PartyTypes.FindByID .CaseType.PartyTypeID}}
                                    <option selected value="{{$partyType.ID}}" data-cy="partytype-option">
                                        {{$partyType.Name}}
                                    </option>
                                {{else}}
                                    <option selected></option>
                                {{end}}
                                {{range .PartyTypes.Items}}
                                    <option value="{{.ID}}" data-cy="partytype-option">{{.Name}}</option>
                                {{end}}
                            </select>
                        {{end}}
                        <label for="party-type">Select Party Type</label>
                    </div>
                    <div class="form-floating mb-3">
                        {{$name = "teamId"}}
                        {{if and .Errors (.Errors.Find $name)}}
                            {{$errs := .Errors.Find $name}}
                            <select id="team"
                                    class="form-select {{if $errs}}is-invalid{{end}}"
                                    name="{{$name}}"
                                    aria-describedby="teamIdFeedback"
                            >
                                {{if .CaseType.TeamID}}
                                    {{$team := .Teams.FindByID .CaseType.TeamID}}
                                    <option selected value="{{$team.ID}}" data-cy="team-option">
                                        {{$team.Name}}
                                    </option>
                                {{else}}
                                    <option selected></option>
                                {{end}}
                                {{range .Teams.Items}}
                                    <option value="{{.ID}}" data-cy="team-option">{{.Name}}</option>
                                {{end}}
                            </select>
                            <div id="{{$name}}Feedback" class="invalid-feedback">
                                {{range $errs}}
                                    <p>{{.Detail}}</p>
                                {{end}}
                            </div>
                        {{else}}
                            <select id="team"
                                    class="form-select"
                                    name="{{$name}}"
                                    {{if .CaseType}}disabled{{end}}
                            >
                                {{if .CaseType}}
                                    {{$team := .Teams.FindByID .CaseType.TeamID}}
                                    <option selected value="{{$team.ID}}" data-cy="team-option">
                                        {{$team.Name}}
                                    </option>
                                {{else}}
                                    <option selected></option>
                                    {{range .Teams.Items}}
                                        <option value="{{.ID}}" data-cy="team-option">{{.Name}}</option>

                                    {{end}}
                                {{end}}
                            </select>
                        {{end}}
                        <label for="team">Select Team</label>
                    </div>
                    <div class="form-floating mb-3">
                        {{$name = "template"}}
                        {{if and .Errors (.Errors.Find $name)}}
                            {{$errs := .Errors.Find $name}}
                            <textarea name="{{$name}}"
                                      id="{{$name}}"
                                      class="form-control font-monospace {{if $errs}}is-invalid{{end}}"
                                      style="height: 600px"
                                      aria-describedby="{{$name}}}Feedback"
                            >
                                {{- if .CaseType.Template}}{{.CaseType.Pretty}}{{end -}}
                            </textarea>
                            <div id="{{$name}}Feedback" class="invalid-feedback">
                                {{range $errs}}
                                    <p>{{.Detail}}</p>
                                {{end}}
                            </div>
                        {{else}}
                            <textarea name="{{$name}}"
                                      id="{{$name}}"
                                      class="form-control font-monospace"
                                      style="height: 600px"
                                      {{if .CaseType}}readonly{{end}}
                            >
                                {{- if .CaseType.Template}}{{.CaseType.Pretty}}{{end -}}
                            </textarea>
                        {{end}}
                        <label for="{{$name}}">Form template</label>
                    </div>
                    {{if and (not .Errors) .CaseType}}
                        <input type="hidden" name="partyTypeId" value="{{.CaseType.PartyTypeID}}">
                        <input type="hidden" name="teamId" value="{{.CaseType.TeamID}}">
                    {{end}}
                    <button class="btn btn-primary">Save</button>
                </form>
            </div>
        </div>
    </div>
    </body>
    </html>
{{end}}
