presubmits:
  - name: pull-core-go-test
    run_if_changed: ".go$|^go.mod$|^go.sum$"
    decorate: true
    spec:
      containers:
        - image: golang:1.16
          command: [ "bash", "-c" ]
          args:
            - |
              go mod download &&
              make gen &&
              (git diff --exit-code || echo ">>\n>> Changes detected. You have to re-run 'make gen'\n>>\n" && exit 1) &&
              go test ./pkg/...
