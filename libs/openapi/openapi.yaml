info:
  description: Hello
  title: Core OpenAPI definition
  version: 0.0.1
openapi: "3.0.0"
components:
  schemas:
    HasTypeMeta:
      description: Represents an entity that has an apiVersion
      properties:
        apiVersion:
          type: string
          example: "core.nrc.no/v1"
        kind:
          type: string
          example: "Model"
    hasTimestamps:
      description: Represents an entity that has creation and deletion timestamps
      properties:
        metadata:
          type: object
          properties:
            creationTimestamp:
              type: string
              format: date-time
            deletionTimestamp:
              type: string
              format: date-time
            updateTimestamp:
              type: string
              format: date-time
    HasResourceVersion:
      description: Represents a versioned entity
      properties:
        metadata:
          type: object
          properties:
            resourceVersion:
              type: integer
    RuntimeObjectBase:
      description: Represents the base of a RuntimeObject
      allOf:
        - $ref: "#/components/schemas/HasTypeMeta"
    RuntimeObject:
      description: Represents a standard entity
      allOf:
        - $ref: "#/components/schemas/HasTypeMeta"
        - $ref: "#/components/schemas/HasUid"
        - $ref: "#/components/schemas/HasMeta"
        - $ref: "#/components/schemas/hasTimestamps"
        - $ref: "#/components/schemas/HasResourceVersion"
    RuntimeObjectList:
      description: Represents a list of RuntimeObjects
      type: object
      properties:
        items:
          type: array
          items:
            $ref: "#/components/schemas/RuntimeObject"
    CreateRuntimeObject:
      description: Represents a payload to create a runtimeObject
      allOf:
        - $ref: "#/components/schemas/HasTypeMeta"
        - $ref: "#/components/schemas/HasMeta"
    UpdateRuntimeObject:
      description: Represents a payload to update a runtimeObject
      allOf:
        - $ref: "#/components/schemas/HasTypeMeta"
        - $ref: "#/components/schemas/HasMeta"
        - $ref: "#/components/schemas/HasResourceVersion"
    HasMeta:
      description: Represents an entity that has metadata
      properties:
        metadata:
          type: object
          properties:
            name:
              type: string
              example: mycustomresources.core.nrc.no
            labels:
              type: object
              additionalProperties:
                type: string
              example:
                "rbac.core.nrc.no/co": "uganda"
                "rbac.core.nrc.no/cc": "ucla"
            annotations:
              type: object
              additionalProperties:
                type: string
              example:
                "description": "Example annotation description"
                "notes": "Some helpful notes"
    HasUid:
      description: Represents an entity that has an UID
      properties:
        metadata:
          type: object
          properties:
            uid:
              type: string
              format: uuid
    FormElementType:
      description: The type of a form element
      type: string
      enum:
        - section
        - text
        - checkbox
        - radio
    FormElement:
      description: Represents a form element
      type: object
      properties:
        type:
          $ref: "#/components/schemas/FormElementType"
        children:
          type: array
          items:
            allOf:
              - $ref: "#/components/schemas/FormElement"
    FormSchema:
      description: Represents the schema of a form
      type: object
      properties:
        root:
          $ref: "#/components/schemas/FormElement"
    ModelDefinition:
      description: Form definition
      type: object
      allOf:
        - $ref: "#/components/schemas/RuntimeObjectBase"
      properties:
        spec:
          type: object
          properties:
            group:
              type: string
              example: core.nrc.no
            names:
              type: object
              properties:
                singular:
                  type: string
                  example: mycustomtype
                plural:
                  type: string
                  example: mycustomtypes
                kind:
                  type: string
                  example: MyCustomType
            versions:
              type: array
              items:
                type: object
                properties:
                  name:
                    type: string
                    example: v1
                  schema:
                    type: object
                    properties:
                      formSchema:
                        $ref: "#/components/schemas/FormSchema"
paths:
  "/apis":
    get:
      responses:
        '200':
          description: List of available apis
          content:
            "application/json":
              schema:
                type: object
                properties: { }
  "/apis/core.nrc.no/v1/models":
    post:
      requestBody:
        required: true
        description: "The model definition to create"
        content:
          "application/json":
            schema:
              allOf:
                - $ref: "#/components/schemas/CreateRuntimeObject"
                - $ref: "#/components/schemas/ModelDefinition"
      responses:
        '201':
          description: Successful creation of form definition
          content:
            "application/json":
              schema:
                allOf:
                  - $ref: "#/components/schemas/RuntimeObject"
                  - $ref: "#/components/schemas/ModelDefinition"
    get:
      responses:
        '200':
          description: List of available form definitions
          content:
            "application/json":
              schema:
                type: object
                properties:
                  items:
                    type: array
                    items:
                      allOf:
                        - $ref: "#/components/schemas/RuntimeObject"
                        - $ref: "#/components/schemas/ModelDefinition"
  "/apis/core.nrc.no/v1/models/{uid}":
    parameters:
      - name: version
        in: query
        required: false
        description: The version of the form definition to retrieve. Otherwise defaults to latest version
        schema:
          type: string
      - name: uid
        in: path
        required: true
        description: The id of the model definition
        schema:
          type: string
    get:
      responses:
        '200':
          description: List of available form definitions
          content:
            "application/json":
              schema:
                type: object
                properties:
                  items:
                    type: array
                    items:
                      allOf:
                        - $ref: "#/components/schemas/RuntimeObject"
                        - $ref: "#/components/schemas/ModelDefinition"
    put:
      requestBody:
        required: true
        description: "The model definition to update"
        content:
          "application/json":
            schema:
              allOf:
                - $ref: "#/components/schemas/UpdateRuntimeObject"
                - $ref: "#/components/schemas/ModelDefinition"
      responses:
        '201':
          description: Successful creation of form definition
          content:
            "application/json":
              schema:
                allOf:
                  - $ref: "#/components/schemas/RuntimeObject"
                  - $ref: "#/components/schemas/ModelDefinition"
  "/apis/{group}/{version}/{resourceName}":
    parameters:
      - name: group
        in: path
        description: The name of the api group
        required: true
        schema:
          type: string
      - name: version
        in: path
        description: The version of the api group
        required: true
        schema:
          type: string
      - name: resourceName
        in: path
        description: The name of the api resource
        required: true
        schema:
          type: string
      - name: selector
        in: query
        description: queyr selector
        required: false
        schema:
          type: string
    get:
      responses:
        200:
          description: Gets the list of resources
          content:
            "application/json":
              schema:
                $ref: "#/components/schemas/RuntimeObjectList"
    post:
      responses:
        200:
          description: Creates a resource
          content:
            "application/json":
              schema:
                $ref: "#/components/schemas/CreateRuntimeObject"

  "/apis/{group}/{version}/{resourceName}/{uid}":
    parameters:
      - name: group
        in: path
        description: The name of the api group
        required: true
        schema:
          type: string
      - name: version
        in: path
        description: The version of the api group
        required: true
        schema:
          type: string
      - name: resourceName
        in: path
        description: The name of the api resource
        required: true
        schema:
          type: string
      - name: uid
        in: path
        description: The uid of the api resource
        required: true
        schema:
          type: string
    get:
      description: Gets a resource
      responses:
        200:
          description: Successful GET resource
          content:
            "application/json":
              schema:
                $ref: "#/components/schemas/RuntimeObject"
    put:
      description: Updates a resource
      requestBody:
        content:
          "application/json":
            schema:
              $ref: "#/components/schemas/UpdateRuntimeObject"
      responses:
        200:
          description: Successful PUT resource
          content:
            "application/json":
              schema:
                $ref: "#/components/schemas/RuntimeObject"
