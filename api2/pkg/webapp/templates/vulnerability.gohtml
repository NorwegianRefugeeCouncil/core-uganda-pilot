{{define "vulnerability"}}
    <!doctype html>
    <html lang="en">
    {{template "head"}}
    <body>

    {{template "navbar"}}

    <script type="application/javascript">

        function onAddAttributeClick() {
            let container = document.getElementById("attribute-container")
            let attributes = document.getElementsByClassName("attribute-control")
            let count = attributes.length

            let div = document.createElement("div")
            div.classList.add("input-group")
            div.classList.add("attribute")
            div.classList.add("mb-3")

            let input = document.createElement("input")
            input.name = "attribute-" + count
            input.classList.add("attribute-control")
            input.classList.add("form-control")
            input.type = "text"
            input.value = ""

            let btn = document.createElement("button")
            btn.classList.add("btn")
            btn.classList.add("btn-outline-secondary")
            btn.innerHTML = "X"
            btn.onclick = () => removeAttribute(div)

            div.appendChild(input)
            div.appendChild(btn)
            container.appendChild(div)
        }

        function removeAttribute(element) {
            element.remove()
            updateAttributeNames()
        }

        function updateAttributeNames() {
            let attributes = document.getElementsByClassName("attribute")
            for (let i = 0; i < attributes.length; i++) {
                let attribute = attributes[i]
                attribute.setAttribute("name", "attribute-" + i)
            }
        }

        document.addEventListener("DOMContentLoaded", function (event) {
            let btn = document.getElementById("add-attribute-button")
            btn.onclick = ev => onAddAttributeClick()

            let attributes = document.getElementsByClassName("attribute")
            for (let attribute of attributes) {
                let removeAttributeButton = attribute.getElementsByTagName("button")[0]
                removeAttributeButton.onclick = () => removeAttribute(attribute)
            }

        });

    </script>

    <form method="post" action="/vulnerabilities/{{.Vulnerability.ID}}">
        <div class="container mt-4">
            <div class="row">
                <div class="col">
                    <div class="input-group mb-3">
                        <span class="input-group-text">ID</span>
                        <input class="form-control" type="text" readonly value="{{.Vulnerability.ID}}"/>
                    </div>
                    <div class="input-group mb-3">
                        <span class="input-group-text">Name</span>
                        <input class="form-control" type="text" readonly value="{{.Vulnerability.Name}}"/>
                    </div>
                    <div class="input-group mb-3">
                        <span class="input-group-text">Sub</span>
                        <input class="form-control" type="text" readonly value="{{.Vulnerability.SubjectType}}"/>
                    </div>
                    <h6>Description</h6>
                    {{range .Vulnerability.LongFormulation}}
                        <div class="card mb-3">
                            <div class="card-body">
                                <div class="input-group mb-3">
                                    <span class="input-group-text">Locale</span>
                                    <input class="form-control" type="text" readonly value="{{.Locale}}"/>
                                </div>
                                <div class="input-group">
                                    <span class="input-group-text">Description</span>
                                    <input class="form-control" type="text" readonly value="{{.Translation}}"/>
                                </div>
                            </div>
                        </div>
                    {{end}}

                    <div class="card mb-3">
                        <div class="card-body">
                            <h5 class="card-title">
                                Attributes
                            </h5>
                            <small>Attributes required for vulnerability determination</small>
                            <div id="attribute-container">
                                {{range $i, $e := .Vulnerability.AttributesForDetermination}}
                                    <div class="input-group mb-3 attribute">
                                        <input name="attribute-{{$i}}" class="attribute-control form-control"
                                               type="text"
                                               value="{{$e}}"/>
                                        <button class="btn btn-outline-secondary" type="button">X</button>
                                    </div>
                                {{end}}
                            </div>
                            <button type="button" id="add-attribute-button" class="btn btn-primary">Add</button>
                        </div>
                        </div>
                    </div>

                    <button class="btn btn-primary" type="submit">Save</button>

                </div>
            </div>
        </div>
    </form>
    </body>
    </html>
{{end}}
